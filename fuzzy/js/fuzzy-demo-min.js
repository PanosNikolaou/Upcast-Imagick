var svgns="http://www.w3.org/2000/svg";var svg=null;var tickTime=2000;var initTick=null;var workTick=null;var tankchar=["A","B","C","D","E","X","Y"];var level_mode=["high","up","down"];var mode={mainInput:1,mainOutputX:1,mainOutputY:1,demandTanksLevel:[0.85,0.3,0.85,0.85,0.75,0.75,0.75],remoteTanksInput:[1,1,1,1,1,1,1],remoteTanksOutput:[1,1,1,1,1,1,1],tankMaxWorkLevel:[1,1,1,1,1,1,1],tankMinWorkLevel:[0.3,0.1,0.3,0.3,0.3,0.3,0.3]};var rmt={currTanksLevel:[0,0,0,0,0,0,0],lastTanksLevel:[0,0,0,0,0,0,0],valveTanksInput:[0,0,0,0,0,0,0]};var pxTanksCapacity=[110,15,120,90,112,80,220];var maxTanksLevel=[1,1,1,1,1,1,1];var highTanksLevel=[0.7,0.3,0.7,0.7,0.7,0.7,0.7];var lowTanksLevel=[0.1,0.1,0.1,0.1,0.1,0.1,0.1];var minTanksLevel=[0,0,0,0,0,0,0];var TanksLevelIndicator=[["red","red","red","red","red","red","red"],["red","red","red","red","red","red","red"],["red","red","red","red","red","red","red"]];var pumpLevelIndicator=[["red","red","red"],["red","red","red"]];var inf_bilans=0;var inf_addPack=0;var inf_subPack=0;var nm="http://www.w3.org/2000/svg";function show_dialog(a){$("<div />").html(a).dialog()}function show_remote(){$("#remote_container").dialog({width:360,height:"auto",title:"Regulacje Fuzzy-Logic"})}function setAttr(d,a,b){var c=svg.getElementById(d);c.setAttributeNS(null,a,b)}function fillTanks(){setAttr("zbiornik_wyszumiania","height",pxTanksCapacity[0]*rmt.currTanksLevel[0]);setAttr("koryto_przelewowe","height",pxTanksCapacity[1]*rmt.currTanksLevel[1]);setAttr("zbiornik_wyplywowy","height",pxTanksCapacity[2]*rmt.currTanksLevel[2]);setAttr("flokuator","height",pxTanksCapacity[3]*rmt.currTanksLevel[3]);setAttr("zawor_kanalowy","height",pxTanksCapacity[4]*rmt.currTanksLevel[4]);setAttr("clear_water1","height",pxTanksCapacity[5]*rmt.currTanksLevel[5]);setAttr("tankYY","height",pxTanksCapacity[6]*rmt.currTanksLevel[6])}function addEvents(){for(var b=0;b<7;b++){for(var a=0;a<3;a++){var d="level_"+tankchar[b]+"_"+level_mode[a];var c=svg.getElementById(d);c.addEventListener("click",show_info,false)}}var c=svg.getElementById("mouse_ind1");c.addEventListener("click",show_remote,false);var c=svg.getElementById("mouse_ind2");c.addEventListener("click",show_remote,false);var c=svg.getElementById("mouse_ind3");c.addEventListener("click",show_remote,false);var c=svg.getElementById("dem_level_arrow");c.addEventListener("click",show_remote,false);var c=svg.getElementById("inp_level_arrow");c.addEventListener("click",show_remote,false);var c=svg.getElementById("out_level_arrow");c.addEventListener("click",show_remote,false)}function randomString(){var d="ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";var e=6;var c="";for(var b=0;b<e;b++){var a=Math.floor(Math.random()*d.length);c+=d.substring(a,a+1)}document.randform.randomfield.value=c}function setIndicators(){for(var d=0;d<7;d++){TanksLevelIndicator[0][d]=(rmt.currTanksLevel[d]>=mode.demandTanksLevel[d])?"green":"red";TanksLevelIndicator[1][d]=(rmt.currTanksLevel[d]>=highTanksLevel[d])?"green":"red";TanksLevelIndicator[2][d]=(rmt.currTanksLevel[d]>=lowTanksLevel[d])?"green":"red"}for(var d=0;d<7;d++){$("#valve"+tankchar[d]).progressbar("option","value",parseInt(rmt.valveTanksInput[d]*100));for(var c=0;c<3;c++){var b=null;var f="level_"+tankchar[d]+"_"+level_mode[c];var e=svg.getElementById(f);if(e){var a="indicator "+TanksLevelIndicator[c][d];e.setAttributeNS(null,"class",a)}}}e=svg.getElementById("pumpXlow");e.setAttributeNS(null,"class","arc "+pumpLevelIndicator[0][0]);e=svg.getElementById("pumpXhigh");e.setAttributeNS(null,"class","arc "+pumpLevelIndicator[0][1]);e=svg.getElementById("pumpYlow");e.setAttributeNS(null,"class","arc "+pumpLevelIndicator[1][0]);e=svg.getElementById("pumpYhigh");e.setAttributeNS(null,"class","arc "+pumpLevelIndicator[1][1])}function tick(){clearTimeout(workTick);$.getJSON("fuzzy-logic-x-ajax-tank.php",{table:rmt,setmode:mode},function(a){rmt=a;fillTanks()});setIndicators();workTick=setTimeout(tick,tickTime)}function show_info(a){show_dialog("<p>node = "+a.target.id+"</p>")}function register_svg(){var b=document.getElementById("embed");try{svg=b.getSVGDocument()}catch(a){initTick=setTimeout(register_svg,250);return}if(svg){clearTimeout(initTick);init()}else{initTick=setTimeout(register_svg,250);return}}function refreshValues(){clearTimeout(workTick);var e=$("#input").slider("option","value"),c=$("#outputx").slider("option","value"),b=$("#outputy").slider("option","value"),a=$("#demand").slider("option","value");$("#inp_val").text(e);$("#outx_val").text(c);$("#outy_val").text(b);$("#dem_val").text(a);mode.mainInput=parseFloat(e/100);for(var d=0;d<7;d++){mode.remoteTanksInput[d]=mode.mainInput}mode.mainOutputX=parseFloat(c/100);mode.remoteTanksOutput[4]=mode.mainOutputX;mode.remoteTanksOutput[5]=mode.mainOutputX;mode.mainOutputY=parseFloat(b/100);mode.remoteTanksOutput[6]=mode.mainOutputY;var g=(mode.mainOutputY+mode.mainOutputX)/2;for(var d=0;d<4;d++){mode.remoteTanksOutput[d]=g}mode.demandTanksLevel[6]=parseFloat(a/100);var f=svg.getElementById("inp_text");f.textContent=e+"%";var f=svg.getElementById("outx_text");f.textContent=c+"%";var f=svg.getElementById("outy_text");f.textContent=b+"%";var f=svg.getElementById("dem_text");f.textContent=a+"%";pumpLevelIndicator[0][0]=(mode.mainOutputX>0.3)?"green":"red";pumpLevelIndicator[0][1]=(mode.mainOutputX>0.7)?"green":"red";pumpLevelIndicator[1][0]=(mode.mainOutputY>0.3)?"green":"red";pumpLevelIndicator[1][1]=(mode.mainOutputY>0.7)?"green":"red";workTick=setTimeout(tick,tickTime)}function init(){fillTanks();addEvents();$("#input").slider({orientation:"horizontal",range:"min",max:100,value:parseInt(mode.mainInput*100),slide:refreshValues,change:refreshValues});$("#outputx").slider({orientation:"horizontal",range:"min",max:100,value:parseInt(mode.remoteTanksOutput[5]*100),slide:refreshValues,change:refreshValues});$("#outputy").slider({orientation:"horizontal",range:"min",max:100,value:parseInt(mode.remoteTanksOutput[6]*100),slide:refreshValues,change:refreshValues});$("#demand").slider({orientation:"horizontal",range:"min",max:100,value:parseInt(mode.demandTanksLevel[6]*100),slide:refreshValues,change:refreshValues});$("#valveA").progressbar({value:parseInt(rmt.valveTanksInput[0]*100)});$("#valveB").progressbar({value:parseInt(rmt.valveTanksInput[1]*100)});$("#valveC").progressbar({value:parseInt(rmt.valveTanksInput[2]*100)});$("#valveD").progressbar({value:parseInt(rmt.valveTanksInput[3]*100)});$("#valveE").progressbar({value:parseInt(rmt.valveTanksInput[4]*100)});$("#valveX").progressbar({value:parseInt(rmt.valveTanksInput[5]*100)});$("#valveY").progressbar({value:parseInt(rmt.valveTanksInput[6]*100)});$("#inp_val").text(parseInt(mode.mainInput*100));$("#outx_val").text(parseInt(mode.mainOutputX*100));$("#outy_val").text(parseInt(mode.mainOutputY*100));$("#dem_val").text(parseInt(mode.demandTanksLevel[6]*100));pumpLevelIndicator[0][0]=(mode.mainOutputX>0.3)?"green":"red";pumpLevelIndicator[0][1]=(mode.mainOutputX>0.7)?"green":"red";pumpLevelIndicator[1][0]=(mode.mainOutputY>0.3)?"green":"red";pumpLevelIndicator[1][1]=(mode.mainOutputY>0.7)?"green":"red";tick()};